<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ËÅ∑Ê•≠ÂúñÈëë ‚Äî Áø†Êòü‰πãÂΩ±</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#1a1a2e; color:#ccc; font-family:'Segoe UI',sans-serif; padding:20px; }
h1 { text-align:center; color:#e8d080; font-size:24px; margin-bottom:8px; }
.subtitle { text-align:center; color:#888; font-size:13px; margin-bottom:24px; }

.table-container { overflow-x: auto; max-width: 1200px; margin: 0 auto; }
table { width: 100%; border-collapse: collapse; background: #16213e; border: 2px solid #334; border-radius: 8px; overflow: hidden; }
th, td { padding: 12px; text-align: left; border-bottom: 1px solid #334; }
th { background: #111827; color: #e8d080; font-weight: bold; white-space: nowrap; position: sticky; top: 0; }
tr:hover { background: #1e293b; }
tr:last-child td { border-bottom: none; }

.sprite-col { width: 60px; text-align: center; }
.sprite-col canvas { display: inline-block; vertical-align: middle; }

.class-name { color: #e8d080; font-size: 15px; font-weight: bold; }
.class-id { color: #666; font-size: 11px; }

.tags { display: inline-flex; gap: 4px; flex-wrap: wrap; }
.tag { background: #334; color: #aaa; padding: 2px 6px; border-radius: 4px; font-size: 10px; }

.weapons { color: #8ab; font-size: 12px; }
.mov { color: #ccc; font-weight: bold; }

.stats { font-size: 11px; color: #aaa; white-space: nowrap; }
.stats span { display: inline-block; width: 32px; text-align: right; }
.stats .lbl { color: #666; width: auto; margin-right: 2px; }

.promo { font-size: 11px; color: #ffa500; }
.promo-list { color: #8ab; }

.faction-toggle { text-align:center; margin-bottom:20px; }
.faction-toggle button {
  background:#16213e; color:#ccc; border:2px solid #334; padding:8px 16px;
  margin:0 4px; cursor:pointer; border-radius:4px; font-size:13px;
}
.faction-toggle button.active { border-color:#e8d080; color:#e8d080; }
</style>
</head>
<body>
<h1>‚öîÔ∏è ËÅ∑Ê•≠ÂúñÈëë</h1>
<p class="subtitle">Áø†Êòü‰πãÂΩ± ‚Äî ÂÖ®ËÅ∑Ê•≠‰∏ÄË¶Ω</p>

<div class="faction-toggle">
  <button id="btn-player" class="active" onclick="setFaction('player')">ÊàëÊñπ</button>
  <button id="btn-enemy" onclick="setFaction('enemy')">ÊïµÊñπ</button>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th class="sprite-col"></th>
        <th>ËÅ∑Ê•≠</th>
        <th>Ê≠¶Âô®</th>
        <th>MOV</th>
        <th>È°ûÂûã</th>
        <th>Âä†Êàê</th>
        <th>ËΩâËÅ∑</th>
      </tr>
    </thead>
    <tbody id="class-list"></tbody>
  </table>
</div>

<script src="../js/data/items.js"></script>
<script src="../js/data/classes.js"></script>
<script src="../js/data/chapters.js"></script>
<script src="../js/sprites.js"></script>
<script>
// Minimal GameMap stub for sprites
const GameMap = { tileSize:32, scale:2, width:20, height:15, terrain:[], getTerrain:()=>'plain', screenToTile:()=>({x:0,y:0}), camX:0, camY:0 };

let currentFaction = 'player';

const WEAPON_NAMES = { sword:'Âäç', lance:'Êßç', axe:'Êñß', bow:'Âºì', staff:'Êùñ', fire:'ÁÅ´', thunder:'Èõ∑', wind:'È¢®', dark:'Êöó' };
const TAG_NAMES = { armored:'üõ°Ô∏è ÈáçË£ù', cavalry:'üêé È®éÂÖµ', flying:'ü¶Ö È£õË°å', mounted:'üê¥ ‰πòÈ®é', undead:'üíÄ ‰∏çÊ≠ªÊóè' };

function setFaction(f) {
  currentFaction = f;
  document.getElementById('btn-player').className = f==='player'?'active':'';
  document.getElementById('btn-enemy').className = f==='enemy'?'active':'';
  renderList();
}

function renderList() {
  const tbody = document.getElementById('class-list');
  tbody.innerHTML = '';
  
  const classIds = Object.keys(CLASSES);
  
  classIds.forEach((classId, i) => {
    const cls = CLASSES[classId];
    // Simple filter: if enemy-only classes, only show in enemy tab
    const isEnemyOnly = ['soldier', 'knight', 'darkMage', 'brigand', 'skeleton'].includes(classId);
    if (currentFaction === 'player' && isEnemyOnly) return;
    
    const tr = document.createElement('tr');
    
    // 1. Sprite
    const tdSprite = document.createElement('td');
    tdSprite.className = 'sprite-col';
    const canvas = document.createElement('canvas');
    const scale = 2;
    canvas.width = 40 * scale;
    canvas.height = 40 * scale;
    canvas.style.width = (40 * scale) + 'px';
    canvas.style.height = (40 * scale) + 'px';
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;
    ctx.scale(scale, scale);
    
    const hairColors = ['#8040a0','#c04040','#4060c0','#40a040','#a08040','#d08050','#606060','#d0a030'];
    const unit = {
      classId: classId,
      faction: currentFaction,
      hp: 20, maxHp: 20,
      portrait: currentFaction === 'player' ? { hair: hairColors[i%8], skin:'#fdb', eyes:'#222' } : null,
      isBoss: false,
    };
    Sprites.drawUnit(ctx, unit, 4, 4, false);
    tdSprite.appendChild(canvas);
    tr.appendChild(tdSprite);
    
    // Save for animation loop
    canvas.dataset.classId = classId;
    canvas.dataset.hairIndex = i % 8;
    
    // 2. Class Name
    const tdName = document.createElement('td');
    tdName.innerHTML = `<div class="class-name">${cls.name}</div>`;
    tr.appendChild(tdName);
    
    // 3. Weapons
    const tdWpn = document.createElement('td');
    const wpnNames = (cls.weapons || []).map(w => WEAPON_NAMES[w] || w).join(' / ');
    tdWpn.innerHTML = `<div class="weapons">üó°Ô∏è ${wpnNames}</div>`;
    tr.appendChild(tdWpn);
    
    // 4. MOV
    const tdMov = document.createElement('td');
    tdMov.innerHTML = `<div class="mov">üèÉ ${cls.mov || 5}</div>`;
    tr.appendChild(tdMov);
    
    // 5. Tags
    const tdTags = document.createElement('td');
    if (cls.tags && cls.tags.length > 0) {
      const tagsHtml = cls.tags.map(t => `<span class="tag">${TAG_NAMES[t] || t}</span>`).join('');
      tdTags.innerHTML = `<div class="tags">${tagsHtml}</div>`;
    } else {
      tdTags.innerHTML = ``;
    }
    tr.appendChild(tdTags);
    
    // 6. Bonus Stats
    const tdStats = document.createElement('td');
    const bns = cls.bonus || {};
    if (Object.keys(bns).length > 0) {
      tdStats.innerHTML = `
        <div class="stats">
          <span class="lbl">HP</span><span>+${bns.hp||0}</span>
          <span class="lbl">Âäõ</span><span>+${bns.str||0}</span>
          <span class="lbl">È≠î</span><span>+${bns.mag||0}</span>
          <span class="lbl">ÊäÄ</span><span>+${bns.skl||0}</span><br>
          <span class="lbl">ÈÄü</span><span>+${bns.spd||0}</span>
          <span class="lbl">ÈÅã</span><span>+${bns.lck||0}</span>
          <span class="lbl">Èò≤</span><span>+${bns.def||0}</span>
          <span class="lbl">È≠îÈò≤</span><span>+${bns.res||0}</span>
        </div>
      `;
    } else {
      tdStats.innerHTML = '<span style="color:#555">-</span>';
    }
    tr.appendChild(tdStats);
    
    // 7. Promotion
    const tdPromo = document.createElement('td');
    if (cls.promo && cls.promo.length > 0) {
      const pNames = cls.promo.map(p => CLASSES[p.to] ? CLASSES[p.to].name : p.to).join(', ');
      tdPromo.innerHTML = `<div class="promo">ÂèØËΩâËÅ∑: <span class="promo-list">${pNames}</span></div>`;
    } else if (cls.promoted) {
      tdPromo.innerHTML = `<div class="promo" style="color:#e8d080">‚≠ê ‰∏äÁ¥öËÅ∑</div>`;
      
    } else {
      tdPromo.innerHTML = `<div class="promo" style="color:#666">ÁÑ°Ê≥ïËΩâËÅ∑</div>`;
    }
    tr.appendChild(tdPromo);
    
    tbody.appendChild(tr);
  });
}

window.onload = function() {
  setTimeout(renderList, 100);
};

// Animation loop
setInterval(function() {
  Sprites.tick();
  const canvases = document.querySelectorAll('.sprite-col canvas');
  const hairColors = ['#8040a0','#c04040','#4060c0','#40a040','#a08040','#d08050','#606060','#d0a030'];
  
  canvases.forEach(canvas => {
    const ctx = canvas.getContext('2d');
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.scale(2, 2);
    
    const classId = canvas.dataset.classId;
    const hIndex = parseInt(canvas.dataset.hairIndex) || 0;
    
    const unit = {
      classId: classId,
      faction: currentFaction,
      hp: 20, maxHp: 20,
      portrait: currentFaction === 'player' ? { hair: hairColors[hIndex], skin:'#fdb', eyes:'#222' } : null,
      isBoss: false,
    };
    Sprites.drawUnit(ctx, unit, 4, 4, false);
  });
}, 200);
</script>
</body>
</html>
